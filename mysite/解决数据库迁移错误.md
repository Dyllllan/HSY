# 解决数据库迁移错误

## 错误原因

错误信息：`Table 'project.jobs_recommendationspage' doesn't exist`

**原因**：创建了新的 `RecommendationsPage` Wagtail页面模型，但还没有运行数据库迁移来创建对应的数据库表。

## 解决方案

### 方法1：使用命令行（推荐）

在项目根目录（包含 `manage.py` 的目录）打开终端，运行：

```bash
# 1. 创建迁移文件（如果还没有创建）
python manage.py makemigrations jobs

# 2. 执行迁移，创建数据库表
python manage.py migrate
```

### 方法2：已创建迁移文件

我已经为您创建了迁移文件 `0003_recommendationspage.py`，您只需要运行：

```bash
python manage.py migrate
```

## 验证迁移是否成功

迁移成功后，您应该看到类似这样的输出：

```
Running migrations:
  Applying jobs.0003_recommendationspage... OK
```

## 然后就可以在Wagtail后台创建页面了

1. 访问 `http://127.0.0.1:8000/admin/`
2. 进入 "Pages" 菜单
3. 选择要添加推荐页面的父页面
4. 点击 "Add child page"
5. 选择 "个性化推荐页面"
6. 填写页面信息并发布

## 如果迁移文件已存在但仍报错

如果迁移文件已存在但迁移没有执行，请检查：

1. **确认迁移文件存在**：
   - 检查 `mysite/jobs/migrations/0003_recommendationspage.py` 是否存在

2. **检查迁移状态**：
   ```bash
   python manage.py showmigrations jobs
   ```
   应该看到 `0003_recommendationspage` 标记为 `[ ]`（未应用）或 `[X]`（已应用）

3. **强制应用迁移**：
   ```bash
   python manage.py migrate jobs 0003_recommendationspage
   ```

## 常见问题

### Q: 迁移时提示 "No changes detected"
**A**: 检查 `jobs/models.py` 中的 `RecommendationsPage` 类是否正确保存

### Q: 迁移时提示表已存在
**A**: 可能之前已经创建过，可以尝试：
```bash
python manage.py migrate --fake jobs 0003_recommendationspage
```

### Q: 仍然报错
**A**: 尝试重置迁移（谨慎操作）：
```bash
# 删除迁移记录（不删除表）
python manage.py migrate jobs zero
# 重新应用迁移
python manage.py migrate jobs
```

## 注意事项

- 迁移操作会修改数据库结构，建议先备份数据库
- 确保数据库连接正常
- 确保有足够的数据库权限
